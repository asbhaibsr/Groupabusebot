import asyncio
import random
import logging
from datetime import datetime, timedelta
from pyrogram import Client, enums
from pyrogram.errors import Forbidden, BadRequest
from pymongo import MongoClient

# Set up logging
logger = logging.getLogger(__name__)

# Reminder settings
REMINDER_INTERVAL_HOURS = 2  # Interval for sending group activity reminders (in hours)
USERS_TO_TAG_COUNT = 5       # Number of online users to tag

# List of engaging messages
REMINDER_MESSAGES = {
    "funny": [
        "ğ•Šğ•’ğ•“ ğ•ğ• ğ•˜ ğ•šğ•¥ğ•Ÿğ•– ğ•¤ğ•™ğ•’ğ•Ÿğ•¥ ğ•œğ•ªğ•¦ğ•Ÿ ğ•™ğ•’ğ•šğ•Ÿ? ğ•‚ğ•ªğ•’ ğ•ğ•’ğ•šğ•Ÿ ğ•’ğ•œğ•–ğ•ğ•– ğ•“ğ•’ğ•’ğ•¥ ğ•œğ•’ğ•£ ğ•£ğ•’ğ•™ğ•’ ğ•™ğ• ğ• ğ•Ÿ? ğŸ˜…",
        "ğ™†ğ™¤ğ™ ğ™ğ™–ğ™ ğ™®ğ™–ğ™ğ™–ğ™£? ğ™”ğ™– ğ™¨ğ™–ğ™— ğ™ğ™šğ™¡ğ™šğ™œğ™§ğ™–ğ™¢ ğ™—ğ™–ğ™£ğ™™ ğ™ ğ™–ğ™§ğ™ ğ™š ğ™¨ğ™¤ ğ™œğ™–ğ™®ğ™š ğ™ğ™–ğ™ğ™£? ğŸ˜´",
        "êœ°ÉªÊ€ êœ±á´‡ É¢Ê€á´á´œá´˜ á´á´‡ á´„Êœá´œá´˜ á´„Êœá´€á´€á´˜ á´‹á´€Êêœ±á´‡ Ê™á´€á´€á´› á´‹á´€Ê€á´‡á´‡? ğŸ¤«",
        "ğ’œğ’¶ğ’¿ ğ“‰ğ‘œ ğ’·ğ’½ğ’¶ğ‘”ğ“Œğ’¶ğ“ƒ ğ’¿ğ’¾ ğ“ƒğ‘’ğ“ˆğ’½ğ’¶ ğ“ğ’¶ğ‘”ğ’¶ğ“ğ‘’ ğ’½ğ’¶ğ’¾ğ“ƒ ğ“€ğ“ğ’¶? ğŸ˜µâ€ğŸ’«",
        "ğˆğ¬ ğ ğ«ğ¨ğ®ğ© ğ¦ğ ğ¤ğ¨ğ¢ ğ£ğ¢ğ§ğğš ğ¡ğšğ¢ ğ²ğš ğ¬ğšğ› ğ¦ğ®ğ¦ğ¦ğ² ğ¤ğ ğğ®ğğ¡ ğ©ğğğ¤ğ ğ¬ğ¨ ğ™œğ™–ğ™®ğ™š? ğŸ¼",
        "ğ“˜ğ“½ğ“·ğ“² ğ“¼ğ“ªğ“·ğ“½ğ“ª ğ“´ğ”‚ğ“¸ğ“· ğ“±ğ“ªğ“²? ğ“šğ“¸ğ“² ğ“½ğ“¸ ğ“±ğ“ªğ“¼ğ“ªğ“¸ ğ”‚ğ“ªğ“ªğ“»! ğŸ˜†",
        "ğ–„ğ–”ğ–š ğ–ğ–“ğ–”ğ–œ ğ–œğ–ğ–†ğ–™'ğ–˜ ğ–—ğ–†ğ–—ğ–Š? ğ•¿ğ–ğ–ğ–˜ ğ–Œğ–—ğ–”ğ–šğ–•'ğ–˜ ğ–†ğ–ˆğ–™ğ–ğ–›ğ–ğ–™ğ–! ğŸ¦„",
        "ï¼¡ï½’ï½…ã€€ï½™ï½ï½•ã€€ï½‡ï½•ï½™ï½“ã€€ï½„ï½…ï½ï½„ã€€ï½ï½’ã€€ï½Šï½•ï½“ï½”ã€€ï½ï½Œï½ï½™ï½‰ï½ï½‡ã€€ï½„ï½…ï½ï½„ï¼Ÿ ğŸ’€"
    ],
    "romantic": [
        "ğ”„ğ”ğ”­ğ”¨ğ”¢ ğ”Ÿğ”¦ğ”«ğ” ğ”¶ğ”¢ğ”¥ ğ”¤ğ”¯ğ”¬ğ”²ğ”­ ğ”¨ğ”¦ğ”±ğ”«ğ” ğ”°ğ”¬ğ”¬ğ”«ğ” ğ”©ğ”ğ”¤ğ”±ğ” ğ”¥ğ”ğ”¦. ğ”ğ”¬ğ”¦ ğ”±ğ”¬ ğ”¢ğ”¨ ğ”¯ğ”¬ğ”ªğ”ğ”«ğ”±ğ”¦ğ”  ğ”ªğ”¢ğ”°ğ”°ğ”ğ”¤ğ”¢ ğ”¨ğ”ğ”¯ğ”¬! â¤ï¸",
        "ğ™†ğ™ğ™¨ğ™ ğ™ ğ™¤ ğ™¥ğ™§ğ™¤ğ™¥ğ™¤ğ™¨ğ™š ğ™ ğ™–ğ™§ğ™£ğ™š ğ™ ğ™– ğ™¢ğ™¤ğ™¤ğ™™ ğ™ğ™–ğ™? ğ™”ğ™šğ™ ğ™œğ™§ğ™¤ğ™ªğ™¥ ğ™–ğ™–ğ™¥ğ™ ğ™ ğ™ğ™šğ™¡ğ™¥ ğ™ ğ™–ğ™§ ğ™¨ğ™–ğ™ ğ™©ğ™– ğ™ğ™–ğ™! ğŸ’",
        "Êá´á´œ'Ê€á´‡ ÊŸÉªá´‹á´‡ á´Ê á´˜Êœá´É´á´‡ Ê™á´€á´›á´›á´‡Ê€Ê - Êá´á´œ á´„Êœá´€Ê€É¢á´‡ á´Ê ÊŸÉªêœ°á´‡! ğŸ”‹â¤ï¸",
        "ğ’¯ğ“Šğ“‚ ğ’½ğ’¶ğ“‡ ğ“Œğ’¶ğ“€ğ“‰ ğ“‚ğ‘’ğ“‡ğ‘’ ğ’¹ğ’½ğ’¶ğ’¹ğ“€ğ’¶ğ“ƒğ‘œ ğ“‚ğ‘’ ğ’½ğ‘œ. ğ’®ğ’¶ğ“‚ğ’¿ğ’½ğ‘’? ğŸ’“",
        "ğ˜ğ¨ğ® + ğŒğ = ğ…ğ¨ğ«ğğ¯ğğ« â¤ï¸ ğ€ğ ğ«ğğ? ğŸ˜˜",
        "ğ“˜ ğ”€ğ“ªğ“·ğ“½ ğ“½ğ“¸ ğ“«ğ“® ğ”‚ğ“¸ğ“¾ğ“» ğ“¯ğ“ªğ“¿ğ“¸ğ“»ğ“²ğ“½ğ“® ğ“±ğ“ªğ“«ğ“²ğ“½... ğ“ğ“·ğ“­ ğ“½ğ“±ğ“®ğ“· ğ“˜ ğ”€ğ“ªğ“·ğ“½ ğ“½ğ“¸ ğ“»ğ“¾ğ“²ğ“· ğ“²ğ“½. ğŸ˜ˆ",
        "ğ–‚ğ–ğ– ğ–‰ğ–” ğ–ˆğ–”ğ–’ğ–•ğ–šğ–™ğ–Šğ–—ğ–˜ ğ–˜ğ–šğ–ˆğ– ğ–†ğ–™ ğ–‹ğ–‘ğ–ğ–—ğ–™ğ–ğ–“ğ–Œ? ğ•­ğ–Šğ–ˆğ–†ğ–šğ–˜ğ–Š ğ–™ğ–ğ–Šğ– ğ–ğ–†ğ–›ğ–Š ğ–“ğ–” ğ–ğ–†ğ–—ğ–‰ ğ–‰ğ–—ğ–ğ–›ğ–Š! ğŸ˜‰",
        "ï¼¡ï½’ï½…ã€€ï½™ï½ï½•ã€€ï½ã€€ï½ï½ï½‡ï½ï½…ï½”ï¼Ÿ ğŸ§² ï¼¢ï½…ï½ƒï½ï½•ï½“ï½…ã€€ï¼©'ï½ã€€ï½ï½”ï½”ï½’ï½ï½ƒï½”ï½…ï½„ã€€ï½”ï½ã€€ï½™ï½ï½•ï¼ ğŸ’«"
    ],
    "commands": [
        "â„•ğ•’ğ•ªğ•– ğ•¦ğ•¤ğ•–ğ•£ğ•¤ ğ•œğ•– ğ•ğ•šğ•–: ğ•“ğ• ğ•¥ ğ•œğ•š ğ•”ğ• ğ•ğ•ğ•’ğ•Ÿğ••ğ•¤ ğ•›ğ•’ğ•Ÿğ•Ÿğ•– ğ•œğ•– ğ•ğ•šğ•ªğ•– `/help` ğ•¥ğ•ªğ•¡ğ•– ğ•œğ•’ğ•£ğ•–ğ•šğ•Ÿ. ğŸ¤–",
        "ğ˜½ğ™¤ğ™§ğ™šğ™™ ğ™ğ™¤ ğ™§ğ™–ğ™ğ™š ğ™ğ™¤? ğ˜¾ğ™ğ™–ğ™¡ğ™¤, ğ™œğ™–ğ™¢ğ™š ğ™ ğ™ğ™šğ™¡ğ™©ğ™š ğ™ğ™–ğ™ğ™£! `/tictac` ğ™˜ğ™¤ğ™¢ğ™¢ğ™–ğ™£ğ™™ ğ™¨ğ™š ğ™¨ğ™ğ™ªğ™§ğ™ª ğ™ ğ™–ğ™§ğ™¤. ğŸ®",
        "É´á´‡á´¡ á´œá´˜á´…á´€á´›á´‡êœ±! á´›Êá´˜á´‡ `/update` êœ°á´Ê€ ÊŸá´€á´›á´‡êœ±á´› êœ°á´‡á´€á´›á´œÊ€á´‡êœ±. ğŸ†•",
        "ğ’œğ’¶ğ“… ğ’·ğ‘œğ“‰ ğ“ˆğ‘’ ğ“…ğ“‡ğ‘œğ“‚ğ‘œğ“‰ğ‘’ ğ’½ğ‘œğ“ˆğ’¶ğ“€ğ“‰ğ‘’ ğ’½ğ’¶ğ’¾ğ“ƒ? ğ’¯ğ“ğ“…ğ‘’ `/promote` â¬†ï¸",
        "ğ–ğšğ§ğ­ ğ­ğ¨ ğ¬ğğ ğœğ¨ğ¨ğ¥ ğ¬ğ­ğ¢ğœğ¤ğğ«ğ¬? ğ“ğ²ğ©ğ `/sticker` ğŸ­",
        "ğ“˜ğ“¼ ğ“¼ğ“¾ğ“¼ğ“²ğ“¬ ğ“½ğ“±ğ“® ğ“¯ğ“¸ğ“¸ğ“­ ğ“¸ğ“¯ ğ“µğ“¸ğ“¿ğ“®? ğ“Ÿğ“µğ“ªğ”‚ ğ“¼ğ“¸ğ“¶ğ“® ğ”€ğ“²ğ“± `/play` ğŸµ",
        "ğ•¿ğ–ğ–•ğ–Š `/joke` ğ–‹ğ–”ğ–— ğ–† ğ–‰ğ–†ğ–ğ–‘ğ– ğ–‰ğ–”ğ–˜ğ–Š ğ–”ğ–‹ ğ–‘ğ–†ğ–šğ–Œğ–ğ–™ğ–Šğ–—! ğŸ¤£",
        "ï¼´ï½™ï½ï½…ã€€`/quote`ã€€ï½†ï½†ï½†ï½†ï½†ï½†ã€€ï½ã€€ï½„ï½ï½‰ï½Œï½™ã€€ï½ï½ï½”ï½‰ï½–ï½ï½”ï½‰ï½ï½ï½ï½Œã€€ï½‘ï½•ï½ï½”ï½…ï¼ ğŸ’ª"
    ],
    "general": [
        "ğ”„ğ”ğ”§ ğ”¨ğ” ğ”¡ğ”¦ğ”« ğ”¨ğ”ğ”¦ğ”°ğ” ğ”¯ğ”ğ”¥ğ” ğ”°ğ”ğ”Ÿğ”¨ğ”? ğ”ğ”¬ğ”¦ ğ”¦ğ”«ğ”±ğ”¢ğ”¯ğ”¢ğ”°ğ”±ğ”¦ğ”«ğ”¤ ğ”°ğ”±ğ”¬ğ”¯ğ”¶ ğ”¥ğ”ğ”¦? ğŸ“–",
        "ğ˜¼ğ™¥ğ™£ğ™š ğ™›ğ™–ğ™«ğ™¤ğ™§ğ™ğ™©ğ™š ğ™¥ğ™¤ğ™šğ™¢/ğ™¨ğ™ğ™–ğ™®ğ™–ğ™§ğ™ ğ™¨ğ™ğ™–ğ™§ğ™š ğ™ ğ™–ğ™§ğ™¤ ğ™Ÿğ™–ğ™¨ğ™–ğ™£ğ™™ ğ™ ğ™–ğ™§ğ™£ğ™š ğ™¬ğ™–ğ™¡ğ™¤ğ™£ ğ™ ğ™š ğ™¡ğ™ğ™®ğ™š. âœï¸",
        "á´¡Êœá´€á´›'êœ± Êá´á´œÊ€ êœ°á´€á´ á´Ê€Éªá´›á´‡ á´á´á´á´‡É´á´› êœ°Ê€á´á´ á´›ÊœÉªêœ± á´¡á´‡á´‡á´‹? ğŸ—“ï¸",
        "ğ’¯ğ‘’ğ“ğ“ ğ“Šğ“ˆ ğ“ˆğ‘œğ“‚ğ‘’ğ“‰ğ’½ğ’¾ğ“ƒğ‘” ğ’¶ğ’·ğ‘œğ“Šğ“‰ ğ“ğ‘œğ“Šğ“‡ğ“ˆğ‘’ğ’» ğ“Œğ‘’ ğ’¹ğ‘œğ“ƒ'ğ“‰ ğ“€ğ“ƒğ‘œğ“Œ! ğŸ¤«",
        "ğ–ğ¡ğšğ­'ğ¬ ğ­ğ¡ğ ğ¦ğ¨ğ¬ğ­ ğšğğ¯ğğ§ğ­ğ®ğ«ğ¨ğ®ğ¬ ğ­ğ¡ğ¢ğ§ğ  ğ²ğ¨ğ®'ğ¯ğ ğğ¯ğğ« ğğ¨ğ§ğ? ğŸš€",
        "ğ“—ğ“¸ğ”€ ğ”€ğ“ªğ“¼ ğ”‚ğ“¸ğ“¾ğ“» ğ“­ğ“ªğ”‚? ğ“¢ğ“±ğ“ªğ“»ğ“® ğ”‚ğ“¸ğ“¾ğ“» ğ“±ğ“²ğ“°ğ“±ğ“¼ ğ“ªğ“·ğ“­ ğ“µğ“¸ğ”€ğ“¼! â˜€ï¸ğŸŒ§ï¸",
        "ğ•¯ğ–” ğ–ğ–”ğ–š ğ–ğ–†ğ–›ğ–Š ğ–† ğ–‰ğ–†ğ–ğ–‘ğ– ğ–—ğ–”ğ–šğ–™ğ–ğ–“ğ–Š? ğ•¾ğ–ğ–†ğ–—ğ–Š ğ–ğ–™ ğ–œğ–ğ–™ğ– ğ–šğ–˜! â°",
        "ï¼·ï½ˆï½™ï½”ã€€ï½„ï½ã€€ï½™ï½ï½•ã€€ï½„ï½ã€€ï½—ï½ˆï½…ï½ã€€ï½™ï½ï½•ã€€ï½†ï½…ï½…ï½Œã€€ï½‚ï½ï½’ï½…ï½„ï¼Ÿã€€ï¼´ï½…ï½Œï½Œã€€ï½•ï½“ã€€ï½™ï½ï½•ï½’ã€€ï½—ï½ï½™ï½“ï¼ ğŸ¨"
    ],
    "motivational": [
        "ğ•‹ğ• ğ••ğ•’ğ•ª ğ•šğ•¤ ğ•’ ğ•˜ğ•£ğ•–ğ•’ğ•¥ ğ••ğ•’ğ•ª ğ•¥ğ•  ğ•“ğ•  ğ•¤ğ• ğ•ğ•–ğ•¥ğ•™ğ•šğ•Ÿğ•˜ ğ•’ğ•ğ•’ğ•«ğ•šğ•Ÿğ•˜! âœ¨",
        "ğ˜¿ğ™¤ğ™£'ğ™© ğ™¨ğ™©ğ™¤ğ™¥ ğ™¬ğ™ğ™šğ™£ ğ™®ğ™¤ğ™ª'ğ™§ğ™š ğ™©ğ™ğ™§ğ™šğ™™. ğ™ğ™©ğ™¤ğ™¥ ğ™¬ğ™ğ™šğ™£ ğ™®ğ™¤ğ™ª'ğ™§ğ™š ğ™™ğ™¤ğ™£ğ™š. ğŸ’ª",
        "Êá´á´œÊ€ á´É´ÊŸÊ ÊŸÉªá´Éªá´› Éªs Êá´á´œÊ€êœ±á´‡ÊŸêœ° - Ê™Ê€á´‡á´€á´‹ êœ°Ê€á´‡á´‡! ğŸ¦…",
        "ğ’¯ğ’½ğ‘’ ğ’·ğ‘’ğ“ˆğ“‰ ğ“Œğ’¶ğ“ ğ“‰ğ‘œ ğ“…ğ“‡ğ‘’ğ’¹ğ’¾ğ’¸ğ“‰ ğ“‰ğ’½ğ‘’ ğ’»ğ“Šğ“Šğ“‡ğ‘’ ğ’¾ğ“ˆ ğ“‰ğ‘œ ğ’¸ğ“‡ğ‘’ğ’¶ğ“‰ğ‘’ ğ’¾ğ“‰. ğŸš€",
        "ğ’ğ®ğœğœğğ¬ğ¬ ğ¢ğ¬ ğ§ğ¨ğ­ ğŸğ¢ğ§ğšğ¥, ğŸğšğ¢ğ¥ğ®ğ«ğ ğ¢ğ¬ ğ§ğ¨ğ­ ğŸğšğ­ğšğ¥: ğˆğ­ ğ¢ğ¬ ğ­ğ¡ğ ğœğ¨ğ®ğ«ğšğ ğ ğ­ğ¨ ğœğ¨ğ§ğ­ğ¢ğ§ğ®ğ ğ­ğ¡ğšğ­ ğœğ¨ğ®ğ§ğ­ğ¬. ğŸ†",
        "ğ“£ğ“±ğ“® ğ“¸ğ“·ğ”‚ ğ“¹ğ“®ğ“»ğ“¼ğ“¸ğ“· ğ”‚ğ“¸ğ“¾ ğ“¼ğ“±ğ“¸ğ“¾ğ“µğ“­ ğ“½ğ”‚ ğ“½ğ“¸ ğ“«ğ“® ğ“«ğ“®ğ“½ğ“® ğ“½ğ“±ğ“ªğ“· ğ“²ğ“¼ ğ“½ğ“±ğ“® ğ“¹ğ“®ğ“¼ğ“· ğ”‚ğ“¸ğ“¾ ğ”€ğ“®ğ“»ğ“® ğ”‚ğ“®ğ“¼ğ“½ğ“®ğ“»ğ“­ğ“ªğ”‚. ğŸŒŸ",
        "ğ–„ğ–”ğ–š ğ–†ğ–—ğ–Š ğ–ˆğ–†ğ–•ğ–†ğ–‡ğ–‘ğ–Š ğ–”ğ–‹ ğ–†ğ–’ğ–†ğ–Ÿğ–ğ–“ğ–Œ ğ–™ğ–ğ–ğ–“ğ–Œğ–˜! ğ•­ğ–Šğ–‘ğ–ğ–Šğ–›ğ–Š ğ–ğ–“ ğ–ğ–”ğ–šğ–—ğ–˜ğ–Šğ–‘ğ–‹. ğŸ’«",
        "ï¼¤ï½ï½'ï½”ã€€ï½—ï½ï½‰ï½”ã€€ï½†ï½†ï½†ï½†ï½†ã€€ï½”ï½ˆï½…ã€€ï½ï½…ï½’ï½†ï½…ï½ƒï½”ã€€ï½ï½ï½ï½…ï½ï½”ï¼ã€€ï¼´ï½ï½‹ï½…ã€€ï½”ï½ˆï½…ã€€ï½ï½ï½ï½…ï½ï½”ã€€ï½ï½ï½„ã€€ï½ï½ï½‹ï½…ã€€ï½‰ï½”ã€€ï½ï½…ï½’ï½†ï½…ï½ƒï½”ï¼ ğŸŒˆ"
    ],
    "group": [
        "ğ”Šğ”¯ğ”¬ğ”²ğ”­ ğ”ªğ”¢ğ”ªğ”Ÿğ”¢ğ”¯ğ”°, ğ”ğ”ğ”§ ğ”¨ğ”¦ ğ”ªğ”¢ğ”¢ğ”±ğ”¦ğ”«ğ”¤ ğ”°ğ”¥ğ”²ğ”¯ğ”² ğ”¨ğ”ğ”¯ğ”±ğ”¢ ğ”¥ğ”ğ”¦ğ”«! ğŸ¤",
        "ğ™ƒğ™šğ™® ğ™¥ğ™šğ™¤ğ™¥ğ™¡ğ™š! ğ™‡ğ™šğ™©'s ğ™¢ğ™–ğ™ ğ™š ğ™©ğ™ğ™ğ™¨ ğ™œğ™§ğ™¤ğ™ªğ™¥ ğ™¢ğ™¤ğ™§ğ™š ğ™–ğ™˜ğ™©ğ™ğ™«ğ™š. ğ™’ğ™ğ™¤'ğ™¨ ğ™ğ™£? ğŸ’¬",
        "É¢Ê€á´á´œá´˜ É¢á´á´€ÊŸ: 100+ á´á´‡êœ±êœ±á´€É¢á´‡êœ± á´›á´á´…á´€Ê! á´„á´€É´ á´¡á´‡ á´…á´ Éªá´›? ğŸ’¯",
        "ğ’¢ğ“‡ğ‘œğ“Šğ“… ğ“‡ğ“Šğ“ğ‘’ğ“ˆ ğ“‡ğ‘’ğ“‚ğ’¾ğ“ƒğ’¹ğ‘’ğ“‡: ğµğ‘’ ğ“€ğ’¾ğ“ƒğ’¹, ğ’·ğ‘’ ğ’¶ğ’¸ğ“‰ğ’¾ğ“‹ğ‘’, ğ’¶ğ“ƒğ’¹ ğ’½ğ’¶ğ“‹ğ“‹ğ‘’ ğ’»ğ“Šğ“ƒ! ğŸ¤",
        "ğ‹ğğ­'ğ¬ ğ°ğğ¥ğœğ¨ğ¦ğ ğ¨ğ®ğ« ğ§ğğ° ğ¦ğğ¦ğ›ğğ«ğ¬! ğ’ğšğ² ğ¡ğ¢! ğŸ‘‹",
        "ğ“¦ğ“±ğ“ªğ“½'ğ“¼ ğ”‚ğ“¸ ğ“¯ğ“¯ğ“¯ğ“¯ğ“¯ ğ“½ ğ“­ğ“²ğ“¼ğ“¬ğ“¾ğ“¼ğ“¼ ğ“½ğ“¸ğ“­ğ“ªğ“½? ğ“›ğ“®ğ“½'ğ“¼ ğ“«ğ“»ğ“ªğ“²ğ“·ğ“¼ğ“½ğ“¸ğ“»ğ“¶! ğŸ’¡",
        "ğ•¿ğ–ğ–ğ–˜ ğ–Œğ–—ğ–”ğ–šğ–• ğ–ğ–˜ ğ–†ğ–‡ğ–”ğ–šğ–™ ğ–™ğ–” ğ–ğ–ğ–™ 500+ ğ–’ğ–Šğ–’ğ–‡ğ–Šğ–—ğ–˜! ğ–€ğ–˜ğ–Š `/invite` ğ–™ğ–” ğ–‡ğ–—ğ–ğ–“ğ–Œ ğ–‹ğ–—ğ–ğ–Šğ–“ğ–‰ğ–˜. ğŸš€",
        "ï¼¬ï½…ï½”'ï½“ã€€ï½ï½Œï½ï½™ã€€ï½ã€€ï½‡ï½ï½ï½…ï¼ã€€ï¼´ï½™ï½ï½…ã€€`/game`ã€€ï½”ï½ã€€ï½“ï½…ï½…ã€€ï½ï½•ï½’ã€€ï½‡ï½’ï½ï½•ï½ã€€ï½‡ï½ï½ï½…ï½“ï¼ ğŸ²"
    ]
}

def get_random_message():
    """Fetches a random message from the dictionary."""
    message_type = random.choice(list(REMINDER_MESSAGES.keys()))
    return random.choice(REMINDER_MESSAGES[message_type])

async def send_random_reminder(client: Client, db: MongoClient):
    """Sends a random reminder to all active groups."""
    if db is None:
        logger.warning("MongoDB not connected. Cannot send group activity reminders.")
        return

    try:
        active_groups = [doc['chat_id'] for doc in db.groups.find({})]
    except Exception as e:
        logger.error(f"Error fetching active groups from DB: {e}")
        return

    for chat_id in active_groups:
        try:
            bot_member = await client.get_chat_member(chat_id, client.me.id)
            if bot_member.status == enums.ChatMemberStatus.ADMINISTRATOR:
                
                online_members = []
                # Pyrogram's `get_chat_members` is an async iterator
                async for member in client.get_chat_members(chat_id):
                    if not member.user.is_bot:
                        online_members.append(member.user)
                
                # Shuffle the list and select a few members to tag
                random.shuffle(online_members)
                members_to_tag = online_members[:USERS_TO_TAG_COUNT]
                
                mentions = " ".join([f"<a href='tg://user?id={user.id}'>{user.first_name}</a>" for user in members_to_tag])
                
                random_message = get_random_message()
                final_message = f"{mentions}\n\n{random_message}" if mentions else random_message
                
                await client.send_message(chat_id, final_message, parse_mode=enums.ParseMode.HTML)
                logger.info(f"Sent group activity reminder to group {chat_id}")
                
                await asyncio.sleep(5)  # Add a small delay between groups to avoid FloodWait
        except Exception as e:
            logger.error(f"Error sending group activity reminder to chat {chat_id}: {e}")

async def reminder_scheduler(client: Client, db: MongoClient):
    """Schedules both user-set and group activity reminders."""
    logger.info("Reminder scheduler started.")
    
    group_reminder_task = None
    
    while True:
        try:
            # Check for and send user-set reminders every minute
            if db is not None:
                current_time = datetime.now()
                reminders_to_send = db.reminders.find({"due_time": {"$lte": current_time}})
                
                for reminder in reminders_to_send:
                    user_id = reminder['user_id']
                    chat_id = reminder['chat_id']
                    text = reminder['text']
                    
                    try:
                        await client.send_message(chat_id, f"â° Reminder for <a href='tg://user?id={user_id}'>you</a>: {text}", parse_mode=enums.ParseMode.HTML)
                        logger.info(f"User-set reminder sent to user {user_id} in chat {chat_id}.")
                        db.reminders.delete_one({"_id": reminder['_id']})
                    except (Forbidden, BadRequest) as e:
                        logger.error(f"Failed to send user-set reminder to chat {chat_id}: {e}")
                        db.reminders.delete_one({"_id": reminder['_id']})
                    except Exception as e:
                        logger.error(f"An unexpected error occurred while sending user-set reminder: {e}")
            
            # Start the group activity reminder task if it's not already running
            if group_reminder_task is None or group_reminder_task.done():
                group_reminder_task = asyncio.create_task(send_random_reminder(client, db))
            
            await asyncio.sleep(60) # Wait for 1 minute before next check
            
        except Exception as e:
            logger.error(f"An error occurred in the reminder scheduler: {e}")
